<!DOCTYPE html>
<html lang="en" dir="ltr">

	<head>

		<meta charset="utf-8">

		<title>Separating Axis Theorem</title>

		<style>

			body {

				margin: 0;

				overflow: hidden;

			}

		</style>

	</head>

	<body>

		<canvas id="canvas"></canvas>

		<script src="SAT.js"></script>

		<script>

			var canvas = document.getElementById("canvas");
			var ctx = canvas.getContext("2d");
			var width = canvas.width = window.innerWidth;
			var height = canvas.height = window.innerHeight;


			var V = SAT.Vector;
			var P = SAT.Polygon;

			P.prototype.collidesWith = function(polygon, response){
			    return SAT.testPolygonPolygon(this, polygon, response);
			};

			P.prototype.draw = function (ctx) {
			    var points = this.calcPoints;
			    var i = points.length;

			    ctx.save();
			    ctx.translate(this.pos.x, this.pos.y);
			    ctx.beginPath();
			    ctx.moveTo(points[0].x, points[0].y);
			    while (i--) ctx.lineTo(points[i].x, points[i].y);
			    ctx.closePath();
			    ctx.fill();
			    ctx.restore();

			};


			var pointer = new P(new V(0, 0), [
			    new V(0, 0),
			    new V(30, 0),
			    new V(0, 30)
			]);

			var polygon = new P(new V(100, 100), [
			    new V(25,25),
			  	new V(25,-25),
			  	new V(-25,-25),
			  	new V(-25,25)
			]);


			var response = new SAT.Response();
			document.onmousemove = function (e) {
			    pointer.pos.x = e.pageX;
			    pointer.pos.y = e.pageY;

			};

			(function draw() {
			    ctx.clearRect(0, 0, width, height);

			    ctx.fillStyle = "red";
			    pointer.draw(ctx);

			    ctx.fillStyle = "black";
			    polygon.draw(ctx);

				polygon.setAngle(polygon.angle + 0.01);

				response.clear();
			    var collided = polygon.collidesWith(pointer,response);
			    if (collided) {
			        polygon.pos.x -= response.overlapV.x;
			        polygon.pos.y -= response.overlapV.y;
			    }

				requestAnimationFrame( draw );

			})();

		</script>

	</body>

</html>
